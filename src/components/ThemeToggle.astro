<script>
	class ThemeToggle extends HTMLElement {
		constructor() {
			super();
			// Find the button element inside this custom element
			const button = this.querySelector("button");

			if (button) {
				// Add a click event listener to the button
				button.addEventListener("click", (e) => {
					if (e.currentTarget instanceof HTMLButtonElement) {
						// isPressed === dark mode currently on
						let isPressed = e.currentTarget.getAttribute("aria-pressed") === "true";

						// Create a custom event to notify the theme change
						let themeChangeEvent = new CustomEvent("theme-change", {
							detail: {
								theme: isPressed ? "light" : "dark",
							},
						});

						// Dispatch the theme change event to ThemeProvider.astro
						document.dispatchEvent(themeChangeEvent);

						// Toggle the aria-pressed attribute
						button.setAttribute("aria-pressed", String(!isPressed));
					}
				});
			}
		}
	}

	customElements.define("theme-toggle", ThemeToggle);
</script>
